import{r as b,j as N}from"./react-lj-GjI_S.js";import{R as Tt,O as ze,P as Fe,S as At,a as Se,V as Lt,b as Dt,B as kt,N as zt,A as Ft,W as It,C as Ht,c as U,d as st,e as Wt,L as _e,f as Bt,U as $t,T as Nt,D as Gt,g as ve,h as Vt,i as qt,j as Ut,k as Xt,l as Yt,m as Zt,n as Kt,o as Jt}from"./three-D2i4Mdkq.js";import{j as Qt}from"./react-use-measure-Co7J8o1p.js";import{F as er,u as tr}from"./its-fine-5ubNbTJQ.js";import{c as oe,R as rr}from"./react-reconciler-CHnQ7fJq.js";import{s as Ye}from"./scheduler-DutjV2e-.js";import{_ as Ie}from"./@babel-CF3RwP-h.js";import{c as nr}from"./react-dom-CWDkwPos.js";import{c as or}from"./zustand-v1BGvohc.js";import"./maath-pyxpI7Bm.js";import{G as He,D as ir,M as xe,O as sr}from"./three-stdlib-9NPZ0-Ox.js";import{s as ar,p as cr,c as lr}from"./suspend-react-BKIKQNXN.js";function ur(e){let t;const n=new Set,i=(v,r)=>{const o=typeof v=="function"?v(t):v;if(o!==t){const d=t;t=r?o:Object.assign({},t,o),n.forEach(c=>c(t,d))}},s=()=>t,u=(v,r=s,o=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let d=r(t);function c(){const p=r(t);if(!o(d,p)){const x=d;v(d=p,x)}}return n.add(c),()=>n.delete(c)},f={setState:i,getState:s,subscribe:(v,r,o)=>r||o?u(v,r,o):(n.add(v),()=>n.delete(v)),destroy:()=>n.clear()};return t=e(i,s,f),f}const fr=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),Ze=fr?b.useEffect:b.useLayoutEffect;function dr(e){const t=typeof e=="function"?ur(e):e,n=(i=t.getState,s=Object.is)=>{const[,u]=b.useReducer(y=>y+1,0),h=t.getState(),m=b.useRef(h),f=b.useRef(i),v=b.useRef(s),r=b.useRef(!1),o=b.useRef();o.current===void 0&&(o.current=i(h));let d,c=!1;(m.current!==h||f.current!==i||v.current!==s||r.current)&&(d=i(h),c=!s(o.current,d)),Ze(()=>{c&&(o.current=d),m.current=h,f.current=i,v.current=s,r.current=!1});const p=b.useRef(h);Ze(()=>{const y=()=>{try{const l=t.getState(),g=f.current(l);v.current(o.current,g)||(m.current=l,o.current=g,u())}catch{r.current=!0,u()}},a=t.subscribe(y);return t.getState()!==p.current&&y(),a},[]);const x=c?d:o.current;return b.useDebugValue(x),x};return Object.assign(n,t),n[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const i=[n,t];return{next(){const s=i.length<=0;return{value:i.shift(),done:s}}}},n}const We={},pr=e=>void Object.assign(We,e);function vr(e,t){function n(r,{args:o=[],attach:d,...c},p){let x=`${r[0].toUpperCase()}${r.slice(1)}`,y;if(r==="primitive"){if(c.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const a=c.object;y=re(a,{type:r,root:p,attach:d,primitive:!0})}else{const a=We[x];if(!a)throw new Error(`R3F: ${x} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(o))throw new Error("R3F: The args prop must be an array!");y=re(new a(...o),{type:r,root:p,attach:d,memoizedProps:{args:o}})}return y.__r3f.attach===void 0&&(y.isBufferGeometry?y.__r3f.attach="geometry":y.isMaterial&&(y.__r3f.attach="material")),x!=="inject"&&Me(y,c),y}function i(r,o){let d=!1;if(o){var c,p;(c=o.__r3f)!=null&&c.attach?Ce(r,o,o.__r3f.attach):o.isObject3D&&r.isObject3D&&(r.add(o),d=!0),d||(p=r.__r3f)==null||p.objects.push(o),o.__r3f||re(o,{}),o.__r3f.parent=r,De(o),ne(o)}}function s(r,o,d){let c=!1;if(o){var p,x;if((p=o.__r3f)!=null&&p.attach)Ce(r,o,o.__r3f.attach);else if(o.isObject3D&&r.isObject3D){o.parent=r,o.dispatchEvent({type:"added"}),r.dispatchEvent({type:"childadded",child:o});const y=r.children.filter(l=>l!==o),a=y.indexOf(d);r.children=[...y.slice(0,a),o,...y.slice(a)],c=!0}c||(x=r.__r3f)==null||x.objects.push(o),o.__r3f||re(o,{}),o.__r3f.parent=r,De(o),ne(o)}}function u(r,o,d=!1){r&&[...r].forEach(c=>h(o,c,d))}function h(r,o,d){if(o){var c,p,x;if(o.__r3f&&(o.__r3f.parent=null),(c=r.__r3f)!=null&&c.objects&&(r.__r3f.objects=r.__r3f.objects.filter(P=>P!==o)),(p=o.__r3f)!=null&&p.attach)tt(r,o,o.__r3f.attach);else if(o.isObject3D&&r.isObject3D){var y;r.remove(o),(y=o.__r3f)!=null&&y.root&&_r(ye(o),o)}const l=(x=o.__r3f)==null?void 0:x.primitive,g=!l&&(d===void 0?o.dispose!==null:d);if(!l){var a;u((a=o.__r3f)==null?void 0:a.objects,o,g),u(o.children,o,g)}if(delete o.__r3f,g&&o.dispose&&o.type!=="Scene"){const P=()=>{try{o.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?Ye.unstable_scheduleCallback(Ye.unstable_IdlePriority,P):P()}ne(r)}}function m(r,o,d,c){var p;const x=(p=r.__r3f)==null?void 0:p.parent;if(!x)return;const y=n(o,d,r.__r3f.root);if(r.children){for(const a of r.children)a.__r3f&&i(y,a);r.children=r.children.filter(a=>!a.__r3f)}r.__r3f.objects.forEach(a=>i(y,a)),r.__r3f.objects=[],r.__r3f.autoRemovedBeforeAppend||h(x,r),y.parent&&(y.__r3f.autoRemovedBeforeAppend=!0),i(x,y),y.raycast&&y.__r3f.eventCount&&ye(y).getState().internal.interaction.push(y),[c,c.alternate].forEach(a=>{a!==null&&(a.stateNode=y,a.ref&&(typeof a.ref=="function"?a.ref(y):a.ref.current=y))})}const f=()=>{};return{reconciler:rr({createInstance:n,removeChild:h,appendChild:i,appendInitialChild:i,insertBefore:s,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(r,o)=>{if(!o)return;const d=r.getState().scene;d.__r3f&&(d.__r3f.root=r,i(d,o))},removeChildFromContainer:(r,o)=>{o&&h(r.getState().scene,o)},insertInContainerBefore:(r,o,d)=>{if(!o||!d)return;const c=r.getState().scene;c.__r3f&&s(c,o,d)},getRootHostContext:()=>null,getChildHostContext:r=>r,finalizeInitialChildren(r){var o;return!!((o=r==null?void 0:r.__r3f)!=null?o:{}).handlers},prepareUpdate(r,o,d,c){var p;if(((p=r==null?void 0:r.__r3f)!=null?p:{}).primitive&&c.object&&c.object!==r)return[!0];{const{args:y=[],children:a,...l}=c,{args:g=[],children:P,..._}=d;if(!Array.isArray(y))throw new Error("R3F: the args prop must be an array!");if(y.some((E,R)=>E!==g[R]))return[!0];const S=pt(r,l,_,!0);return S.changes.length?[!1,S]:null}},commitUpdate(r,[o,d],c,p,x,y){o?m(r,c,x,y):Me(r,d)},commitMount(r,o,d,c){var p;const x=(p=r.__r3f)!=null?p:{};r.raycast&&x.handlers&&x.eventCount&&ye(r).getState().internal.interaction.push(r)},getPublicInstance:r=>r,prepareForCommit:()=>null,preparePortalMount:r=>re(r.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(r){var o;const{attach:d,parent:c}=(o=r.__r3f)!=null?o:{};d&&c&&tt(c,r,d),r.isObject3D&&(r.visible=!1),ne(r)},unhideInstance(r,o){var d;const{attach:c,parent:p}=(d=r.__r3f)!=null?d:{};c&&p&&Ce(p,r,c),(r.isObject3D&&o.visible==null||o.visible)&&(r.visible=!0),ne(r)},createTextInstance:f,hideTextInstance:f,unhideTextInstance:f,getCurrentEventPriority:()=>t?t():oe.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&L.fun(performance.now)?performance.now:L.fun(Date.now)?Date.now:()=>0,scheduleTimeout:L.fun(setTimeout)?setTimeout:void 0,cancelTimeout:L.fun(clearTimeout)?clearTimeout:void 0}),applyProps:Me}}var Ke,Je;const Pe=e=>"colorSpace"in e||"outputColorSpace"in e,at=()=>{var e;return(e=We.ColorManagement)!=null?e:null},ct=e=>e&&e.isOrthographicCamera,mr=e=>e&&e.hasOwnProperty("current"),ue=typeof window<"u"&&((Ke=window.document)!=null&&Ke.createElement||((Je=window.navigator)==null?void 0:Je.product)==="ReactNative")?b.useLayoutEffect:b.useEffect;function lt(e){const t=b.useRef(e);return ue(()=>void(t.current=e),[e]),t}function hr({set:e}){return ue(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class ut extends b.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}ut.getDerivedStateFromError=()=>({error:!0});const ft="__default",Qe=new Map,gr=e=>e&&!!e.memoized&&!!e.changes;function dt(e){var t;const n=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],n),e[1]):e}const ae=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()};function ye(e){let t=e.__r3f.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const L={obj:e=>e===Object(e)&&!L.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:n="shallow",objects:i="reference",strict:s=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(L.str(e)||L.num(e)||L.boo(e))return e===t;const u=L.obj(e);if(u&&i==="reference")return e===t;const h=L.arr(e);if(h&&n==="reference")return e===t;if((h||u)&&e===t)return!0;let m;for(m in e)if(!(m in t))return!1;if(u&&n==="shallow"&&i==="shallow"){for(m in s?t:e)if(!L.equ(e[m],t[m],{strict:s,objects:"reference"}))return!1}else for(m in s?t:e)if(e[m]!==t[m])return!1;if(L.und(m)){if(h&&e.length===0&&t.length===0||u&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function yr(e){const t={nodes:{},materials:{}};return e&&e.traverse(n=>{n.name&&(t.nodes[n.name]=n),n.material&&!t.materials[n.material.name]&&(t.materials[n.material.name]=n.material)}),t}function br(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function re(e,t){const n=e;return n.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function Le(e,t){let n=e;if(t.includes("-")){const i=t.split("-"),s=i.pop();return n=i.reduce((u,h)=>u[h],e),{target:n,key:s}}else return{target:n,key:t}}const et=/-\d+$/;function Ce(e,t,n){if(L.str(n)){if(et.test(n)){const u=n.replace(et,""),{target:h,key:m}=Le(e,u);Array.isArray(h[m])||(h[m]=[])}const{target:i,key:s}=Le(e,n);t.__r3f.previousAttach=i[s],i[s]=t}else t.__r3f.previousAttach=n(e,t)}function tt(e,t,n){var i,s;if(L.str(n)){const{target:u,key:h}=Le(e,n),m=t.__r3f.previousAttach;m===void 0?delete u[h]:u[h]=m}else(i=t.__r3f)==null||i.previousAttach==null||i.previousAttach(e,t);(s=t.__r3f)==null||delete s.previousAttach}function pt(e,{children:t,key:n,ref:i,...s},{children:u,key:h,ref:m,...f}={},v=!1){const r=e.__r3f,o=Object.entries(s),d=[];if(v){const p=Object.keys(f);for(let x=0;x<p.length;x++)s.hasOwnProperty(p[x])||o.unshift([p[x],ft+"remove"])}o.forEach(([p,x])=>{var y;if((y=e.__r3f)!=null&&y.primitive&&p==="object"||L.equ(x,f[p]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(p))return d.push([p,x,!0,[]]);let a=[];p.includes("-")&&(a=p.split("-")),d.push([p,x,!1,a]);for(const l in s){const g=s[l];l.startsWith(`${p}-`)&&d.push([l,g,!1,l.split("-")])}});const c={...s};return r!=null&&r.memoizedProps&&r!=null&&r.memoizedProps.args&&(c.args=r.memoizedProps.args),r!=null&&r.memoizedProps&&r!=null&&r.memoizedProps.attach&&(c.attach=r.memoizedProps.attach),{memoized:c,changes:d}}function Me(e,t){var n;const i=e.__r3f,s=i==null?void 0:i.root,u=s==null||s.getState==null?void 0:s.getState(),{memoized:h,changes:m}=gr(t)?t:pt(e,t),f=i==null?void 0:i.eventCount;e.__r3f&&(e.__r3f.memoizedProps=h);for(let d=0;d<m.length;d++){let[c,p,x,y]=m[d];if(Pe(e)){const P="srgb",_="srgb-linear";c==="encoding"?(c="colorSpace",p=p===3001?P:_):c==="outputEncoding"&&(c="outputColorSpace",p=p===3001?P:_)}let a=e,l=a[c];if(y.length&&(l=y.reduce((g,P)=>g[P],e),!(l&&l.set))){const[g,...P]=y.reverse();a=P.reverse().reduce((_,S)=>_[S],e),c=g}if(p===ft+"remove")if(a.constructor){let g=Qe.get(a.constructor);g||(g=new a.constructor,Qe.set(a.constructor,g)),p=g[c]}else p=0;if(x&&i)p?i.handlers[c]=p:delete i.handlers[c],i.eventCount=Object.keys(i.handlers).length;else if(l&&l.set&&(l.copy||l instanceof _e)){if(Array.isArray(p))l.fromArray?l.fromArray(p):l.set(...p);else if(l.copy&&p&&p.constructor&&l.constructor===p.constructor)l.copy(p);else if(p!==void 0){var v;const g=(v=l)==null?void 0:v.isColor;!g&&l.setScalar?l.setScalar(p):l instanceof _e&&p instanceof _e?l.mask=p.mask:l.set(p),!at()&&u&&!u.linear&&g&&l.convertSRGBToLinear()}}else{var r;if(a[c]=p,(r=a[c])!=null&&r.isTexture&&a[c].format===Bt&&a[c].type===$t&&u){const g=a[c];Pe(g)&&Pe(u.gl)?g.colorSpace=u.gl.outputColorSpace:g.encoding=u.gl.outputEncoding}}ne(e)}if(i&&i.parent&&e.raycast&&f!==i.eventCount){const d=ye(e).getState().internal,c=d.interaction.indexOf(e);c>-1&&d.interaction.splice(c,1),i.eventCount&&d.interaction.push(e)}return!(m.length===1&&m[0][0]==="onUpdate")&&m.length&&(n=e.__r3f)!=null&&n.parent&&De(e),e}function ne(e){var t,n;const i=(t=e.__r3f)==null||(n=t.root)==null||n.getState==null?void 0:n.getState();i&&i.internal.frames===0&&i.invalidate()}function De(e){e.onUpdate==null||e.onUpdate(e)}function wr(e,t){e.manual||(ct(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function me(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function Sr(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return oe.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return oe.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return oe.ContinuousEventPriority;default:return oe.DefaultEventPriority}}function vt(e,t,n,i){const s=n.get(t);s&&(n.delete(t),n.size===0&&(e.delete(i),s.target.releasePointerCapture(i)))}function _r(e,t){const{internal:n}=e.getState();n.interaction=n.interaction.filter(i=>i!==t),n.initialHits=n.initialHits.filter(i=>i!==t),n.hovered.forEach((i,s)=>{(i.eventObject===t||i.object===t)&&n.hovered.delete(s)}),n.capturedMap.forEach((i,s)=>{vt(n.capturedMap,t,i,s)})}function xr(e){function t(f){const{internal:v}=e.getState(),r=f.offsetX-v.initialClick[0],o=f.offsetY-v.initialClick[1];return Math.round(Math.sqrt(r*r+o*o))}function n(f){return f.filter(v=>["Move","Over","Enter","Out","Leave"].some(r=>{var o;return(o=v.__r3f)==null?void 0:o.handlers["onPointer"+r]}))}function i(f,v){const r=e.getState(),o=new Set,d=[],c=v?v(r.internal.interaction):r.internal.interaction;for(let a=0;a<c.length;a++){const l=ae(c[a]);l&&(l.raycaster.camera=void 0)}r.previousRoot||r.events.compute==null||r.events.compute(f,r);function p(a){const l=ae(a);if(!l||!l.events.enabled||l.raycaster.camera===null)return[];if(l.raycaster.camera===void 0){var g;l.events.compute==null||l.events.compute(f,l,(g=l.previousRoot)==null?void 0:g.getState()),l.raycaster.camera===void 0&&(l.raycaster.camera=null)}return l.raycaster.camera?l.raycaster.intersectObject(a,!0):[]}let x=c.flatMap(p).sort((a,l)=>{const g=ae(a.object),P=ae(l.object);return!g||!P?a.distance-l.distance:P.events.priority-g.events.priority||a.distance-l.distance}).filter(a=>{const l=me(a);return o.has(l)?!1:(o.add(l),!0)});r.events.filter&&(x=r.events.filter(x,r));for(const a of x){let l=a.object;for(;l;){var y;(y=l.__r3f)!=null&&y.eventCount&&d.push({...a,eventObject:l}),l=l.parent}}if("pointerId"in f&&r.internal.capturedMap.has(f.pointerId))for(let a of r.internal.capturedMap.get(f.pointerId).values())o.has(me(a.intersection))||d.push(a.intersection);return d}function s(f,v,r,o){const d=e.getState();if(f.length){const c={stopped:!1};for(const p of f){const x=ae(p.object)||d,{raycaster:y,pointer:a,camera:l,internal:g}=x,P=new U(a.x,a.y,0).unproject(l),_=j=>{var w,O;return(w=(O=g.capturedMap.get(j))==null?void 0:O.has(p.eventObject))!=null?w:!1},S=j=>{const w={intersection:p,target:v.target};g.capturedMap.has(j)?g.capturedMap.get(j).set(p.eventObject,w):g.capturedMap.set(j,new Map([[p.eventObject,w]])),v.target.setPointerCapture(j)},E=j=>{const w=g.capturedMap.get(j);w&&vt(g.capturedMap,p.eventObject,w,j)};let R={};for(let j in v){let w=v[j];typeof w!="function"&&(R[j]=w)}let C={...p,...R,pointer:a,intersections:f,stopped:c.stopped,delta:r,unprojectedPoint:P,ray:y.ray,camera:l,stopPropagation(){const j="pointerId"in v&&g.capturedMap.get(v.pointerId);if((!j||j.has(p.eventObject))&&(C.stopped=c.stopped=!0,g.hovered.size&&Array.from(g.hovered.values()).find(w=>w.eventObject===p.eventObject))){const w=f.slice(0,f.indexOf(p));u([...w,p])}},target:{hasPointerCapture:_,setPointerCapture:S,releasePointerCapture:E},currentTarget:{hasPointerCapture:_,setPointerCapture:S,releasePointerCapture:E},nativeEvent:v};if(o(C),c.stopped===!0)break}}return f}function u(f){const{internal:v}=e.getState();for(const r of v.hovered.values())if(!f.length||!f.find(o=>o.object===r.object&&o.index===r.index&&o.instanceId===r.instanceId)){const d=r.eventObject.__r3f,c=d==null?void 0:d.handlers;if(v.hovered.delete(me(r)),d!=null&&d.eventCount){const p={...r,intersections:f};c.onPointerOut==null||c.onPointerOut(p),c.onPointerLeave==null||c.onPointerLeave(p)}}}function h(f,v){for(let r=0;r<v.length;r++){const o=v[r].__r3f;o==null||o.handlers.onPointerMissed==null||o.handlers.onPointerMissed(f)}}function m(f){switch(f){case"onPointerLeave":case"onPointerCancel":return()=>u([]);case"onLostPointerCapture":return v=>{const{internal:r}=e.getState();"pointerId"in v&&r.capturedMap.has(v.pointerId)&&requestAnimationFrame(()=>{r.capturedMap.has(v.pointerId)&&(r.capturedMap.delete(v.pointerId),u([]))})}}return function(r){const{onPointerMissed:o,internal:d}=e.getState();d.lastEvent.current=r;const c=f==="onPointerMove",p=f==="onClick"||f==="onContextMenu"||f==="onDoubleClick",y=i(r,c?n:void 0),a=p?t(r):0;f==="onPointerDown"&&(d.initialClick=[r.offsetX,r.offsetY],d.initialHits=y.map(g=>g.eventObject)),p&&!y.length&&a<=2&&(h(r,d.interaction),o&&o(r)),c&&u(y);function l(g){const P=g.eventObject,_=P.__r3f,S=_==null?void 0:_.handlers;if(_!=null&&_.eventCount)if(c){if(S.onPointerOver||S.onPointerEnter||S.onPointerOut||S.onPointerLeave){const E=me(g),R=d.hovered.get(E);R?R.stopped&&g.stopPropagation():(d.hovered.set(E,g),S.onPointerOver==null||S.onPointerOver(g),S.onPointerEnter==null||S.onPointerEnter(g))}S.onPointerMove==null||S.onPointerMove(g)}else{const E=S[f];E?(!p||d.initialHits.includes(P))&&(h(r,d.interaction.filter(R=>!d.initialHits.includes(R))),E(g)):p&&d.initialHits.includes(P)&&h(r,d.interaction.filter(R=>!d.initialHits.includes(R)))}}s(y,r,a,l)}}return{handlePointer:m}}const mt=e=>!!(e!=null&&e.render),ht=b.createContext(null),Pr=(e,t)=>{const n=dr((m,f)=>{const v=new U,r=new U,o=new U;function d(a=f().camera,l=r,g=f().size){const{width:P,height:_,top:S,left:E}=g,R=P/_;l.isVector3?o.copy(l):o.set(...l);const C=a.getWorldPosition(v).distanceTo(o);if(ct(a))return{width:P/a.zoom,height:_/a.zoom,top:S,left:E,factor:1,distance:C,aspect:R};{const j=a.fov*Math.PI/180,w=2*Math.tan(j/2)*C,O=w*(P/_);return{width:O,height:w,top:S,left:E,factor:P/O,distance:C,aspect:R}}}let c;const p=a=>m(l=>({performance:{...l.performance,current:a}})),x=new st;return{set:m,get:f,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(a=1)=>e(f(),a),advance:(a,l)=>t(a,l,f()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new Wt,pointer:x,mouse:x,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const a=f();c&&clearTimeout(c),a.performance.current!==a.performance.min&&p(a.performance.min),c=setTimeout(()=>p(f().performance.max),a.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:d},setEvents:a=>m(l=>({...l,events:{...l.events,...a}})),setSize:(a,l,g,P,_)=>{const S=f().camera,E={width:a,height:l,top:P||0,left:_||0,updateStyle:g};m(R=>({size:E,viewport:{...R.viewport,...d(S,r,E)}}))},setDpr:a=>m(l=>{const g=dt(a);return{viewport:{...l.viewport,dpr:g,initialDpr:l.viewport.initialDpr||g}}}),setFrameloop:(a="always")=>{const l=f().clock;l.stop(),l.elapsedTime=0,a!=="never"&&(l.start(),l.elapsedTime=0),m(()=>({frameloop:a}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:b.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(a,l,g)=>{const P=f().internal;return P.priority=P.priority+(l>0?1:0),P.subscribers.push({ref:a,priority:l,store:g}),P.subscribers=P.subscribers.sort((_,S)=>_.priority-S.priority),()=>{const _=f().internal;_!=null&&_.subscribers&&(_.priority=_.priority-(l>0?1:0),_.subscribers=_.subscribers.filter(S=>S.ref!==a))}}}}}),i=n.getState();let s=i.size,u=i.viewport.dpr,h=i.camera;return n.subscribe(()=>{const{camera:m,size:f,viewport:v,gl:r,set:o}=n.getState();if(f.width!==s.width||f.height!==s.height||v.dpr!==u){var d;s=f,u=v.dpr,wr(m,f),r.setPixelRatio(v.dpr);const c=(d=f.updateStyle)!=null?d:typeof HTMLCanvasElement<"u"&&r.domElement instanceof HTMLCanvasElement;r.setSize(f.width,f.height,c)}m!==h&&(h=m,o(c=>({viewport:{...c.viewport,...c.viewport.getCurrentViewport(m)}})))}),n.subscribe(m=>e(m)),n};let he,Cr=new Set,Mr=new Set,Er=new Set;function Ee(e,t){if(e.size)for(const{callback:n}of e.values())n(t)}function ce(e,t){switch(e){case"before":return Ee(Cr,t);case"after":return Ee(Mr,t);case"tail":return Ee(Er,t)}}let Re,je;function Oe(e,t,n){let i=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),Re=t.internal.subscribers,he=0;he<Re.length;he++)je=Re[he],je.ref.current(je.store.getState(),i,n);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function Rr(e){let t=!1,n=!1,i,s,u;function h(v){s=requestAnimationFrame(h),t=!0,i=0,ce("before",v),n=!0;for(const o of e.values()){var r;u=o.store.getState(),u.internal.active&&(u.frameloop==="always"||u.internal.frames>0)&&!((r=u.gl.xr)!=null&&r.isPresenting)&&(i+=Oe(v,u))}if(n=!1,ce("after",v),i===0)return ce("tail",v),t=!1,cancelAnimationFrame(s)}function m(v,r=1){var o;if(!v)return e.forEach(d=>m(d.store.getState(),r));(o=v.gl.xr)!=null&&o.isPresenting||!v.internal.active||v.frameloop==="never"||(r>1?v.internal.frames=Math.min(60,v.internal.frames+r):n?v.internal.frames=2:v.internal.frames=1,t||(t=!0,requestAnimationFrame(h)))}function f(v,r=!0,o,d){if(r&&ce("before",v),o)Oe(v,o,d);else for(const c of e.values())Oe(v,c.store.getState());r&&ce("after",v)}return{loop:h,invalidate:m,advance:f}}function gt(){const e=b.useContext(ht);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function $(e=n=>n,t){return gt()(e,t)}function Be(e,t=0){const n=gt(),i=n.getState().internal.subscribe,s=lt(e);return ue(()=>i(s,t,n),[t,i,n]),null}const rt=new WeakMap;function yt(e,t){return function(n,...i){let s=rt.get(n);return s||(s=new n,rt.set(n,s)),e&&e(s),Promise.all(i.map(u=>new Promise((h,m)=>s.load(u,f=>{f.scene&&Object.assign(f,yr(f.scene)),h(f)},t,f=>m(new Error(`Could not load ${u}: ${f==null?void 0:f.message}`))))))}}function fe(e,t,n,i){const s=Array.isArray(t)?t:[t],u=ar(yt(n,i),[e,...s],{equal:L.equ});return Array.isArray(t)?u:u[0]}fe.preload=function(e,t,n){const i=Array.isArray(t)?t:[t];return cr(yt(n),[e,...i])};fe.clear=function(e,t){const n=Array.isArray(t)?t:[t];return lr([e,...n])};const ie=new Map,{invalidate:nt,advance:ot}=Rr(ie),{reconciler:be,applyProps:ee}=vr(ie,Sr),te={objects:"shallow",strict:!1},jr=(e,t)=>{const n=typeof e=="function"?e(t):e;return mt(n)?n:new It({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function Or(e,t){const n=typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement;if(t){const{width:i,height:s,top:u,left:h,updateStyle:m=n}=t;return{width:i,height:s,top:u,left:h,updateStyle:m}}else if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:i,height:s,top:u,left:h}=e.parentElement.getBoundingClientRect();return{width:i,height:s,top:u,left:h,updateStyle:n}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0,updateStyle:n};return{width:0,height:0,top:0,left:0}}function Tr(e){const t=ie.get(e),n=t==null?void 0:t.fiber,i=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const s=typeof reportError=="function"?reportError:console.error,u=i||Pr(nt,ot),h=n||be.createContainer(u,oe.ConcurrentRoot,null,!1,null,"",s,null);t||ie.set(e,{fiber:h,store:u});let m,f=!1,v;return{configure(r={}){let{gl:o,size:d,scene:c,events:p,onCreated:x,shadows:y=!1,linear:a=!1,flat:l=!1,legacy:g=!1,orthographic:P=!1,frameloop:_="always",dpr:S=[1,2],performance:E,raycaster:R,camera:C,onPointerMissed:j}=r,w=u.getState(),O=w.gl;w.gl||w.set({gl:O=jr(o,e)});let I=w.raycaster;I||w.set({raycaster:I=new Tt});const{params:Y,...k}=R||{};if(L.equ(k,I,te)||ee(I,{...k}),L.equ(Y,I.params,te)||ee(I,{params:{...I.params,...Y}}),!w.camera||w.camera===v&&!L.equ(v,C,te)){v=C;const T=C instanceof Ht,A=T?C:P?new ze(0,0,0,0,.1,1e3):new Fe(75,0,.1,1e3);T||(A.position.z=5,C&&(ee(A,C),("aspect"in C||"left"in C||"right"in C||"bottom"in C||"top"in C)&&(A.manual=!0,A.updateProjectionMatrix())),!w.camera&&!(C!=null&&C.rotation)&&A.lookAt(0,0,0)),w.set({camera:A}),I.camera=A}if(!w.scene){let T;c!=null&&c.isScene?T=c:(T=new At,c&&ee(T,c)),w.set({scene:re(T)})}if(!w.xr){var G;const T=(M,X)=>{const V=u.getState();V.frameloop!=="never"&&ot(M,!0,V,X)},A=()=>{const M=u.getState();M.gl.xr.enabled=M.gl.xr.isPresenting,M.gl.xr.setAnimationLoop(M.gl.xr.isPresenting?T:null),M.gl.xr.isPresenting||nt(M)},F={connect(){const M=u.getState().gl;M.xr.addEventListener("sessionstart",A),M.xr.addEventListener("sessionend",A)},disconnect(){const M=u.getState().gl;M.xr.removeEventListener("sessionstart",A),M.xr.removeEventListener("sessionend",A)}};typeof((G=O.xr)==null?void 0:G.addEventListener)=="function"&&F.connect(),w.set({xr:F})}if(O.shadowMap){const T=O.shadowMap.enabled,A=O.shadowMap.type;if(O.shadowMap.enabled=!!y,L.boo(y))O.shadowMap.type=Se;else if(L.str(y)){var z;const F={basic:kt,percentage:Dt,soft:Se,variance:Lt};O.shadowMap.type=(z=F[y])!=null?z:Se}else L.obj(y)&&Object.assign(O.shadowMap,y);(T!==O.shadowMap.enabled||A!==O.shadowMap.type)&&(O.shadowMap.needsUpdate=!0)}const H=at();H&&("enabled"in H?H.enabled=!g:"legacyMode"in H&&(H.legacyMode=g)),f||ee(O,{outputEncoding:a?3e3:3001,toneMapping:l?zt:Ft}),w.legacy!==g&&w.set(()=>({legacy:g})),w.linear!==a&&w.set(()=>({linear:a})),w.flat!==l&&w.set(()=>({flat:l})),o&&!L.fun(o)&&!mt(o)&&!L.equ(o,O,te)&&ee(O,o),p&&!w.events.handlers&&w.set({events:p(u)});const W=Or(e,d);return L.equ(W,w.size,te)||w.setSize(W.width,W.height,W.updateStyle,W.top,W.left),S&&w.viewport.dpr!==dt(S)&&w.setDpr(S),w.frameloop!==_&&w.setFrameloop(_),w.onPointerMissed||w.set({onPointerMissed:j}),E&&!L.equ(E,w.performance,te)&&w.set(T=>({performance:{...T.performance,...E}})),m=x,f=!0,this},render(r){return f||this.configure(),be.updateContainer(N.jsx(Ar,{store:u,children:r,onCreated:m,rootElement:e}),h,null,()=>{}),u},unmount(){bt(e)}}}function Ar({store:e,children:t,onCreated:n,rootElement:i}){return ue(()=>{const s=e.getState();s.set(u=>({internal:{...u.internal,active:!0}})),n&&n(s),e.getState().events.connected||s.events.connect==null||s.events.connect(i)},[]),N.jsx(ht.Provider,{value:e,children:t})}function bt(e,t){const n=ie.get(e),i=n==null?void 0:n.fiber;if(i){const s=n==null?void 0:n.store.getState();s&&(s.internal.active=!1),be.updateContainer(null,i,null,()=>{s&&setTimeout(()=>{try{var u,h,m,f;s.events.disconnect==null||s.events.disconnect(),(u=s.gl)==null||(h=u.renderLists)==null||h.dispose==null||h.dispose(),(m=s.gl)==null||m.forceContextLoss==null||m.forceContextLoss(),(f=s.gl)!=null&&f.xr&&s.xr.disconnect(),br(s),ie.delete(e)}catch{}},500)})}}be.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:b.version});const Te={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Lr(e){const{handlePointer:t}=xr(e);return{priority:1,enabled:!0,compute(n,i,s){i.pointer.set(n.offsetX/i.size.width*2-1,-(n.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(Te).reduce((n,i)=>({...n,[i]:t(i)}),{}),update:()=>{var n;const{events:i,internal:s}=e.getState();(n=s.lastEvent)!=null&&n.current&&i.handlers&&i.handlers.onPointerMove(s.lastEvent.current)},connect:n=>{var i;const{set:s,events:u}=e.getState();u.disconnect==null||u.disconnect(),s(h=>({events:{...h.events,connected:n}})),Object.entries((i=u.handlers)!=null?i:[]).forEach(([h,m])=>{const[f,v]=Te[h];n.addEventListener(f,m,{passive:v})})},disconnect:()=>{const{set:n,events:i}=e.getState();if(i.connected){var s;Object.entries((s=i.handlers)!=null?s:[]).forEach(([u,h])=>{if(i&&i.connected instanceof HTMLElement){const[m]=Te[u];i.connected.removeEventListener(m,h)}}),n(u=>({events:{...u.events,connected:void 0}}))}}}}const Dr=b.forwardRef(function({children:t,fallback:n,resize:i,style:s,gl:u,events:h=Lr,eventSource:m,eventPrefix:f,shadows:v,linear:r,flat:o,legacy:d,orthographic:c,frameloop:p,dpr:x,performance:y,raycaster:a,camera:l,scene:g,onPointerMissed:P,onCreated:_,...S},E){b.useMemo(()=>pr(Nt),[]);const R=tr(),[C,j]=Qt({scroll:!0,debounce:{scroll:50,resize:0},...i}),w=b.useRef(null),O=b.useRef(null);b.useImperativeHandle(E,()=>w.current);const I=lt(P),[Y,k]=b.useState(!1),[G,z]=b.useState(!1);if(Y)throw Y;if(G)throw G;const H=b.useRef(null);ue(()=>{const T=w.current;j.width>0&&j.height>0&&T&&(H.current||(H.current=Tr(T)),H.current.configure({gl:u,events:h,shadows:v,linear:r,flat:o,legacy:d,orthographic:c,frameloop:p,dpr:x,performance:y,raycaster:a,camera:l,scene:g,size:j,onPointerMissed:(...A)=>I.current==null?void 0:I.current(...A),onCreated:A=>{A.events.connect==null||A.events.connect(m?mr(m)?m.current:m:O.current),f&&A.setEvents({compute:(F,M)=>{const X=F[f+"X"],V=F[f+"Y"];M.pointer.set(X/M.size.width*2-1,-(V/M.size.height)*2+1),M.raycaster.setFromCamera(M.pointer,M.camera)}}),_==null||_(A)}}),H.current.render(N.jsx(R,{children:N.jsx(ut,{set:z,children:N.jsx(b.Suspense,{fallback:N.jsx(hr,{set:k}),children:t??null})})})))}),b.useEffect(()=>{const T=w.current;if(T)return()=>bt(T)},[]);const W=m?"none":"auto";return N.jsx("div",{ref:O,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:W,...s},...S,children:N.jsx("div",{ref:C,style:{width:"100%",height:"100%"},children:N.jsx("canvas",{ref:w,style:{display:"block"},children:n})})})}),an=b.forwardRef(function(t,n){return N.jsx(er,{children:N.jsx(Dr,{...t,ref:n})})}),de=new U,$e=new U,kr=new U,it=new st;function zr(e,t,n){const i=de.setFromMatrixPosition(e.matrixWorld);i.project(t);const s=n.width/2,u=n.height/2;return[i.x*s+s,-(i.y*u)+u]}function Fr(e,t){const n=de.setFromMatrixPosition(e.matrixWorld),i=$e.setFromMatrixPosition(t.matrixWorld),s=n.sub(i),u=t.getWorldDirection(kr);return s.angleTo(u)>Math.PI/2}function Ir(e,t,n,i){const s=de.setFromMatrixPosition(e.matrixWorld),u=s.clone();u.project(t),it.set(u.x,u.y),n.setFromCamera(it,t);const h=n.intersectObjects(i,!0);if(h.length){const m=h[0].distance;return s.distanceTo(n.ray.origin)<m}return!0}function Hr(e,t){if(t instanceof ze)return t.zoom;if(t instanceof Fe){const n=de.setFromMatrixPosition(e.matrixWorld),i=$e.setFromMatrixPosition(t.matrixWorld),s=t.fov*Math.PI/180,u=n.distanceTo(i);return 1/(2*Math.tan(s/2)*u)}else return 1}function Wr(e,t,n){if(t instanceof Fe||t instanceof ze){const i=de.setFromMatrixPosition(e.matrixWorld),s=$e.setFromMatrixPosition(t.matrixWorld),u=i.distanceTo(s),h=(n[1]-n[0])/(t.far-t.near),m=n[1]-h*t.far;return Math.round(h*u+m)}}const ke=e=>Math.abs(e)<1e-10?0:e;function wt(e,t,n=""){let i="matrix3d(";for(let s=0;s!==16;s++)i+=ke(t[s]*e.elements[s])+(s!==15?",":")");return n+i}const Br=(e=>t=>wt(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),$r=(e=>(t,n)=>wt(t,e(n),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function Nr(e){return e&&typeof e=="object"&&"current"in e}const cn=b.forwardRef(({children:e,eps:t=.001,style:n,className:i,prepend:s,center:u,fullscreen:h,portal:m,distanceFactor:f,sprite:v=!1,transform:r=!1,occlude:o,onOcclude:d,castShadow:c,receiveShadow:p,material:x,geometry:y,zIndexRange:a=[16777271,0],calculatePosition:l=zr,as:g="div",wrapperClass:P,pointerEvents:_="auto",...S},E)=>{const{gl:R,camera:C,scene:j,size:w,raycaster:O,events:I,viewport:Y}=$(),[k]=b.useState(()=>document.createElement(g)),G=b.useRef(),z=b.useRef(null),H=b.useRef(0),W=b.useRef([0,0]),T=b.useRef(null),A=b.useRef(null),F=(m==null?void 0:m.current)||I.connected||R.domElement.parentNode,M=b.useRef(null),X=b.useRef(!1),V=b.useMemo(()=>o&&o!=="blending"||Array.isArray(o)&&o.length&&Nr(o[0]),[o]);b.useLayoutEffect(()=>{const B=R.domElement;o&&o==="blending"?(B.style.zIndex=`${Math.floor(a[0]/2)}`,B.style.position="absolute",B.style.pointerEvents="none"):(B.style.zIndex=null,B.style.position=null,B.style.pointerEvents=null)},[o]),b.useLayoutEffect(()=>{if(z.current){const B=G.current=nr.createRoot(k);if(j.updateMatrixWorld(),r)k.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const D=l(z.current,C,w);k.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${D[0]}px,${D[1]}px,0);transform-origin:0 0;`}return F&&(s?F.prepend(k):F.appendChild(k)),()=>{F&&F.removeChild(k),B.unmount()}}},[F,r]),b.useLayoutEffect(()=>{P&&(k.className=P)},[P]);const Ve=b.useMemo(()=>r?{position:"absolute",top:0,left:0,width:w.width,height:w.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:u?"translate3d(-50%,-50%,0)":"none",...h&&{top:-w.height/2,left:-w.width/2,width:w.width,height:w.height},...n},[n,u,h,w,r]),xt=b.useMemo(()=>({position:"absolute",pointerEvents:_}),[_]);b.useLayoutEffect(()=>{if(X.current=!1,r){var B;(B=G.current)==null||B.render(b.createElement("div",{ref:T,style:Ve},b.createElement("div",{ref:A,style:xt},b.createElement("div",{ref:E,className:i,style:n,children:e}))))}else{var D;(D=G.current)==null||D.render(b.createElement("div",{ref:E,style:Ve,className:i,children:e}))}});const Q=b.useRef(!0);Be(B=>{if(z.current){C.updateMatrixWorld(),z.current.updateWorldMatrix(!0,!1);const D=r?W.current:l(z.current,C,w);if(r||Math.abs(H.current-C.zoom)>t||Math.abs(W.current[0]-D[0])>t||Math.abs(W.current[1]-D[1])>t){const Z=Fr(z.current,C);let q=!1;V&&(Array.isArray(o)?q=o.map(K=>K.current):o!=="blending"&&(q=[j]));const se=Q.current;if(q){const K=Ir(z.current,C,O,q);Q.current=K&&!Z}else Q.current=!Z;se!==Q.current&&(d?d(!Q.current):k.style.display=Q.current?"block":"none");const pe=Math.floor(a[0]/2),Pt=o?V?[a[0],pe]:[pe-1,0]:a;if(k.style.zIndex=`${Wr(z.current,C,Pt)}`,r){const[K,Ue]=[w.width/2,w.height/2],we=C.projectionMatrix.elements[5]*Ue,{isOrthographicCamera:Xe,top:Ct,left:Mt,bottom:Et,right:Rt}=C,jt=Br(C.matrixWorldInverse),Ot=Xe?`scale(${we})translate(${ke(-(Rt+Mt)/2)}px,${ke((Ct+Et)/2)}px)`:`translateZ(${we}px)`;let J=z.current.matrixWorld;v&&(J=C.matrixWorldInverse.clone().transpose().copyPosition(J).scale(z.current.scale),J.elements[3]=J.elements[7]=J.elements[11]=0,J.elements[15]=1),k.style.width=w.width+"px",k.style.height=w.height+"px",k.style.perspective=Xe?"":`${we}px`,T.current&&A.current&&(T.current.style.transform=`${Ot}${jt}translate(${K}px,${Ue}px)`,A.current.style.transform=$r(J,1/((f||10)/400)))}else{const K=f===void 0?1:Hr(z.current,C)*f;k.style.transform=`translate3d(${D[0]}px,${D[1]}px,0) scale(${K})`}W.current=D,H.current=C.zoom}}if(!V&&M.current&&!X.current)if(r){if(T.current){const D=T.current.children[0];if(D!=null&&D.clientWidth&&D!=null&&D.clientHeight){const{isOrthographicCamera:Z}=C;if(Z||y)S.scale&&(Array.isArray(S.scale)?S.scale instanceof U?M.current.scale.copy(S.scale.clone().divideScalar(1)):M.current.scale.set(1/S.scale[0],1/S.scale[1],1/S.scale[2]):M.current.scale.setScalar(1/S.scale));else{const q=(f||10)/400,se=D.clientWidth*q,pe=D.clientHeight*q;M.current.scale.set(se,pe,1)}X.current=!0}}}else{const D=k.children[0];if(D!=null&&D.clientWidth&&D!=null&&D.clientHeight){const Z=1/Y.factor,q=D.clientWidth*Z,se=D.clientHeight*Z;M.current.scale.set(q,se,1),X.current=!0}M.current.lookAt(B.camera.position)}});const qe=b.useMemo(()=>({vertexShader:r?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[r]);return b.createElement("group",Ie({},S,{ref:z}),o&&!V&&b.createElement("mesh",{castShadow:c,receiveShadow:p,ref:M},y||b.createElement("planeGeometry",null),x||b.createElement("shaderMaterial",{side:Gt,vertexShader:qe.vertexShader,fragmentShader:qe.fragmentShader})))});let le=0;const ln=or(e=>(ve.onStart=(t,n,i)=>{e({active:!0,item:t,loaded:n,total:i,progress:(n-le)/(i-le)*100})},ve.onLoad=()=>{e({active:!1})},ve.onError=t=>e(n=>({errors:[...n.errors,t]})),ve.onProgress=(t,n,i)=>{n===i&&(le=i),e({active:!0,item:t,loaded:n,total:i,progress:(n-le)/(i-le)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0})),Gr=()=>parseInt(Vt.replace(/\D+/g,"")),Ne=Gr();let ge=null,St="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function _t(e=!0,t=!0,n){return i=>{n&&n(i),e&&(ge||(ge=new ir),ge.setDecoderPath(typeof e=="string"?e:St),i.setDRACOLoader(ge)),t&&i.setMeshoptDecoder(typeof xe=="function"?xe():xe)}}const Ge=(e,t,n,i)=>fe(He,e,_t(t,n,i));Ge.preload=(e,t,n,i)=>fe.preload(He,e,_t(t,n,i));Ge.clear=e=>fe.clear(He,e);Ge.setDecoderPath=e=>{St=e};const un=b.forwardRef(({makeDefault:e,camera:t,regress:n,domElement:i,enableDamping:s=!0,keyEvents:u=!1,onChange:h,onStart:m,onEnd:f,...v},r)=>{const o=$(S=>S.invalidate),d=$(S=>S.camera),c=$(S=>S.gl),p=$(S=>S.events),x=$(S=>S.setEvents),y=$(S=>S.set),a=$(S=>S.get),l=$(S=>S.performance),g=t||d,P=i||p.connected||c.domElement,_=b.useMemo(()=>new sr(g),[g]);return Be(()=>{_.enabled&&_.update()},-1),b.useEffect(()=>(u&&_.connect(u===!0?P:u),_.connect(P),()=>void _.dispose()),[u,P,n,_,o]),b.useEffect(()=>{const S=C=>{o(),n&&l.regress(),h&&h(C)},E=C=>{m&&m(C)},R=C=>{f&&f(C)};return _.addEventListener("change",S),_.addEventListener("start",E),_.addEventListener("end",R),()=>{_.removeEventListener("start",E),_.removeEventListener("end",R),_.removeEventListener("change",S)}},[h,m,f,_,o,x]),b.useEffect(()=>{if(e){const S=a().controls;return y({controls:_}),()=>y({controls:S})}},[e,_]),b.createElement("primitive",Ie({ref:r,object:_,enableDamping:s},v))}),Ae=Ne>=154?"opaque_fragment":"output_fragment";class Vr extends qt{constructor(t){super(t),this.onBeforeCompile=(n,i)=>{const{isWebGL2:s}=i.capabilities;n.fragmentShader=n.fragmentShader.replace(`#include <${Ae}>`,`
        ${s?`#include <${Ae}>`:`#extension GL_OES_standard_derivatives : enable
#include <${Ae}>`}
      vec2 cxy = 2.0 * gl_PointCoord - 1.0;
      float r = dot(cxy, cxy);
      float delta = fwidth(r);     
      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);
      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );
      #include <tonemapping_fragment>
      #include <${Ne>=154?"colorspace_fragment":"encodings_fragment"}>
      `)}}}const fn=b.forwardRef((e,t)=>{const[n]=b.useState(()=>new Vr(null));return b.createElement("primitive",Ie({},e,{object:n,ref:t,attach:"material"}))});class qr extends Zt{constructor(){super({uniforms:{time:{value:0},fade:{value:1}},vertexShader:`
      uniform float time;
      attribute float size;
      varying vec3 vColor;
      void main() {
        vColor = color;
        vec4 mvPosition = modelViewMatrix * vec4(position, 0.5);
        gl_PointSize = size * (30.0 / -mvPosition.z) * (3.0 + sin(time + 100.0));
        gl_Position = projectionMatrix * mvPosition;
      }`,fragmentShader:`
      uniform sampler2D pointTexture;
      uniform float fade;
      varying vec3 vColor;
      void main() {
        float opacity = 1.0;
        if (fade == 1.0) {
          float d = distance(gl_PointCoord, vec2(0.5, 0.5));
          opacity = 1.0 / (1.0 + exp(16.0 * (d - 0.25)));
        }
        gl_FragColor = vec4(vColor, opacity);

        #include <tonemapping_fragment>
	      #include <${Ne>=154?"colorspace_fragment":"encodings_fragment"}>
      }`})}}const Ur=e=>new U().setFromSpherical(new Yt(e,Math.acos(1-Math.random()*2),Math.random()*2*Math.PI)),dn=b.forwardRef(({radius:e=100,depth:t=50,count:n=5e3,saturation:i=0,factor:s=4,fade:u=!1,speed:h=1},m)=>{const f=b.useRef(),[v,r,o]=b.useMemo(()=>{const c=[],p=[],x=Array.from({length:n},()=>(.5+.5*Math.random())*s),y=new Ut;let a=e+t;const l=t/n;for(let g=0;g<n;g++)a-=l*Math.random(),c.push(...Ur(a).toArray()),y.setHSL(g/n,i,.9),p.push(y.r,y.g,y.b);return[new Float32Array(c),new Float32Array(p),new Float32Array(x)]},[n,t,s,e,i]);Be(c=>f.current&&(f.current.uniforms.time.value=c.clock.elapsedTime*h));const[d]=b.useState(()=>new qr);return b.createElement("points",{ref:m},b.createElement("bufferGeometry",null,b.createElement("bufferAttribute",{attach:"attributes-position",args:[v,3]}),b.createElement("bufferAttribute",{attach:"attributes-color",args:[r,3]}),b.createElement("bufferAttribute",{attach:"attributes-size",args:[o,1]})),b.createElement("primitive",{ref:f,object:d,attach:"material",blending:Xt,"uniforms-fade-value":u,depthWrite:!1,transparent:!0,vertexColors:!0}))});function pn({all:e,scene:t,camera:n}){const i=$(({gl:h})=>h),s=$(({camera:h})=>h),u=$(({scene:h})=>h);return b.useLayoutEffect(()=>{const h=[];e&&(t||u).traverse(v=>{v.visible===!1&&(h.push(v),v.visible=!0)}),i.compile(t||u,n||s);const m=new Kt(128);new Jt(.01,1e5,m).update(i,t||u),m.dispose(),h.forEach(v=>v.visible=!1)},[]),null}export{an as C,cn as H,un as O,pn as P,dn as S,Ge as a,Be as b,fn as c,$ as d,ln as u};
